<div class="wrapper">
    <div class="row">
        <div class="side-menu">
            <form class="add-todo-form" #todoForm="ngForm" [formGroup]="addTodoForm" (ngSubmit)="addTodo(todoForm)">
                <mat-form-field class="form-control">
                    <mat-label>Todo</mat-label>
                    <input matInput formControlName="newTodo">
                </mat-form-field>

                <mat-form-field class="form-control">
                    <mat-label>Choose a due date</mat-label>
                    <input matInput [matDatepicker]="picker" [min]="minDate" [max]="maxDate"
                        formControlName="newDueDate">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>

                <mat-form-field class="form-control">
                    <mat-label>Author</mat-label>
                    <mat-select formControlName="author">
                        <mat-option *ngFor="let user of users" [value]="user">{{user.username}}</mat-option>
                    </mat-select>
                </mat-form-field>
                
                <button mat-raised-button color="primary" type="submit" [disabled]="!addTodoForm.valid">Add</button>
            </form>
            <form class="search-form" [formGroup]="searchForm">
                <mat-form-field class="form-control">
                    <mat-label>Search in title</mat-label>
                    <input matInput formControlName="searchValue" (keyup)="filterTodoList('title')">
                </mat-form-field>
            </form>
        </div>
        <div class="todolist-wrapper">
            <div class="filter">
                <span>Filter: </span>
                <button class="filter__item" mat-button color="primary" (click)="filterTodoList('all')">All</button>
                <button class="filter__item" mat-button color="primary" (click)="filterTodoList('done')">Done</button>
                <button class="filter__item" mat-button color="primary" (click)="filterTodoList('undone')">Undone</button>
            </div>
            <div class="mat-elevation-z8">
                <table class="todolist" mat-table [dataSource]="dataSource" matSort>
                    <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef> Select </th>
                        <td mat-cell *matCellDef="let row">
                            <mat-checkbox (change)="toggleCompleted(row)" [(ngModel)]="row.completed"
                                [aria-label]="checkboxLabel(row)">
                            </mat-checkbox>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="index">
                        <th mat-header-cell *matHeaderCellDef>No.</th>
                        <td mat-cell *matCellDef="let row; let i = index;"> {{paginator.pageSize * paginator.pageIndex + i + 1}} </td>
                    </ng-container>

                    <ng-container matColumnDef="username">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Author</th>
                        <td mat-cell *matCellDef="let todo"> {{todo.username}} </td>
                    </ng-container>

                    <ng-container matColumnDef="created">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
                        <td mat-cell *matCellDef="let todo"> {{todo.created | date:'d LLLL y'}} </td>
                    </ng-container>

                    <ng-container matColumnDef="dueDate">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Due date</th>
                        <td mat-cell *matCellDef="let todo"> {{todo.dueDate | date:'d LLLL y'}} </td>
                    </ng-container>

                    <ng-container matColumnDef="title">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>

                        <ng-container *matCellDef="let todo">
                            <td mat-cell *ngIf="activeRowId !== todo.id; else elseBlock">{{todo.title}}</td>
                            <ng-template #elseBlock>
                                <td mat-cell>
                                    <mat-form-field class="form-control">
                                        <input matInput [(ngModel)]="todo.title">
                                    </mat-form-field>
                                </td>
                            </ng-template>
                        </ng-container>
                    </ng-container>

                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef> Action </th>
                        <td mat-cell *matCellDef="let todo">
                            <button mat-icon-button aria-label="save note" (click)="saveTodoItem(todo)"
                                *ngIf="activeRowId == todo.id">
                                <mat-icon class="icon-green">done</mat-icon>
                            </button>
                            <button mat-icon-button aria-label="cancel note" (click)="cancelTodoItem()"
                                *ngIf="activeRowId == todo.id">
                                <mat-icon class="icon-yellow">cancel</mat-icon>
                            </button>
                            <button mat-icon-button color="warn" aria-label="delete note" (click)="deleteTodoItem(todo)"
                                *ngIf="activeRowId == todo.id">
                                <mat-icon>delete_forever</mat-icon>
                            </button>
                            <button mat-icon-button color="primary" aria-label="edit note" (click)="editTodoItem(todo)"
                                *ngIf="activeRowId !== todo.id || !isEditActive">
                                <mat-icon>edit</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
            </div>
        </div>
    </div>
</div>